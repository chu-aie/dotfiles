#!/bin/bash
# {{ if and (eq .chezmoi.os "darwin" "linux") (.system.is_sudoer) -}}

# {{ include (joinPath .chezmoi.sourceDir ".chezmoitemplates/scripts-library") }}
# {{ include (joinPath .chezmoi.sourceDir ".chezmoitemplates/homebrew-library") }}

# The following line is for ShellCheck to correctly identify the above included library
true || source ../.chezmoitemplates/scripts-library
true || source ../.chezmoitemplates/homebrew-library

if brew --version &>/dev/null; then

  readonly wanted_packages=(
    age
    sops
  )
  missing_packages=()

  for package in "${wanted_packages[@]}"; do
    if ! is_brew_package_installed "${package}"; then
      missing_packages+=("${package}")
    fi
  done

  if [[ ${#missing_packages[@]} -gt 0 ]]; then
    log_task "Installing missing packages with brew: ${missing_packages[*]}"

    brew_command=(brew)

    # c "${brew_command[@]}" update
    c "${brew_command[@]}" install "${missing_packages[@]}"
  fi

fi

# {{ end -}}
