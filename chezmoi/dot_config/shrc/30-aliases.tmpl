#!/bin/bash

# This file is automatically sourced by bash, and it's also sourced in .zshrc
# in order to keep the same aliases on both shells. So keep in mind that any
# code here must be compatible with bash and zsh.

alias cz="chezmoi"
TMP_HOME="{{- .chezmoi.workingTree -}}/tmp"
# shellcheck disable=SC2139
alias czdr="chezmoi apply --verbose --destination ${TMP_HOME} --dry-run"
# shellcheck disable=SC2139
alias dotdrop="dotdrop --cfg=${HOME}/.config/dotdrop/config-user.yaml -p {{ .dotdrop.user_profile }}"
# shellcheck disable=SC2139
alias rootdrop="dotdrop --cfg=${HOME}/.config/dotdrop/config-root.yaml -p {{ .dotdrop.root_profile }}"

alias cw="chown-workspace"

alias dkb="dk-build"
alias dkr="dk-run"
alias dkcl="dk-cleanup"
alias dkcp="dk-files-copy"
alias dkc="dk-compose"
alias dkcb="dk-compose build"
alias dkcu="dk-compose up"
alias dkcr="dk-compose run"
alias dki="docker image"
alias dkls="docker image ls"
alias dkl="dkls"
alias dkcls="docker container ls -a"
alias dkirm="docker image rm"
alias dkps="docker ps"
alias deit="docker exec -it"
alias dkx="deit"
alias dkex="deit"

dotenv-vault() {
  npx dotenv-vault "$@"
}
alias dotenv="dotenv-vault"
alias denv="dotenv-vault"

refreshenv() {
  local shell

  shell=$(ps -p $$ -ocomm=) &&
    exec "${shell}"
}

mcd() {
  local dir="$1"

  mkdir -p "${dir}" &&
    cd "${dir}"
}

cdr() {
  local repo="${1:-}"

  cd "${WORKSPACE_ROOT}/projects/${repo}"
}

# See: https://github.com/twpayne/chezmoi/issues/854#issuecomment-675160348
chezmoi-re-run-scripts() { (
  set -ex

  rm -f "${HOME}/.config/chezmoi/chezmoistate.boltdb"
  chezmoi init --apply
); }

# {{ if .system.is_wsl }}
gsudo() {
  local shell

  shell=$(ps -p $$ -ocomm=) &&
    gsudo.exe wsl -d "${WSL_DISTRO_NAME?}" -e "${shell}" "-c" "$*"
}

cdw() {
  local user_profile
  local win_home

  user_profile=$(wslvar USERPROFILE) &&
    win_home=$(wslpath "${user_profile}") &&
    cd "${win_home}"
}
# {{ end }}
