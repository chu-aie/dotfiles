#!/bin/bash

COMMIT_MESSAGE=${1:-"Updated dotfiles by running dotp"}

# {{ template "scripts-library" }}

# The following line is for ShellCheck to correctly identify the above include
true || source ../../.chezmoitemplates/scripts-library

if chezmoi --version &>/dev/null; then
  log_task "Committing dotfile changes and pushing to remote"
  CHEZMOI_REPO="{{ .chezmoi.workingTree }}"
  c git -C "$CHEZMOI_REPO" add -A && git -C "$CHEZMOI_REPO" commit -m "$COMMIT_MESSAGE" && git -C "$CHEZMOI_REPO" push
fi

# {{ if .dotdrop.enabled }}
if dotdrop --version &>/dev/null; then
  DOTDROP_REPO="${HOME}/.config/dotdrop"

  log_task "Committing dotdrop changes and pushing to remote"
  c git -C "$DOTDROP_REPO" commit -a -m "$COMMIT_MESSAGE" && git -C "$DOTDROP_REPO" push
fi
# {{ end }}

# {{ if and .stow.enabled .stow.repo}}
STOW_REPO_DIR="{{ .stow.location }}"
if [ -d "$STOW_REPO_DIR" ]; then
  log_task "Committing stow changes and pushing to remote"
  c git -C "$STOW_REPO_DIR" add -A && git -C "$STOW_REPO_DIR" commit -a -m "$COMMIT_MESSAGE" && git -C "$STOW_REPO_DIR" push
fi
# {{ end }}