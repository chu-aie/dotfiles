#!/bin/bash

# {{ template "scripts-library" }}

# The following line is for ShellCheck to correctly identify the above included library
true || source ../.chezmoitemplates/scripts-library

readonly wanted_packages=(
  apt-transport-https
  lsb-release
  tree
  parallel
  zip
  docker-ce
  docker-ce-cli
  containerd.io
  docker-compose-plugin
  # {{ if .system.is_minimum | not }}
  snapd
  helm
  # {{ end }}
  # skopeo
  openssh-server
  # {{ if .system.is_wsl }}
  wslu
  # {{ else }}
  # {{   if eq .chezmoi.osRelease.versionCodename "bionic" }}
  linux-generic-hwe-18.04
  # {{   else if eq .chezmoi.osRelease.versionCodename "focal" }}
  linux-generic-hwe-20.04
  # {{   end }}
  # {{ end }}
)
missing_packages=()

for package in "${wanted_packages[@]}"; do
  if ! is_apt_package_installed "${package}"; then
    missing_packages+=("${package}")
  fi
done

if [[ ${#missing_packages[@]} -gt 0 ]]; then
  log_task "Installing missing packages with APT: ${missing_packages[*]}"

  c apt update --yes -qq -o=Dpkg::Use-Pty=0
  c apt install --yes -qq -o=Dpkg::Use-Pty=0 --install-recommends "${missing_packages[@]}"
fi
